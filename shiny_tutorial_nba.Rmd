---
title: "Learning Shiny with NBA data"
output:
  html_document: 
    toc: true
    toc_float: true
---
  
This Shiny tutorial was made for the R Ladies NYC meetup on May 8, 2018. Thanks again to the NBA New York office for agreeing to host!!

Shiny is RStudio's framework introduced in 2012 for building interactive plots and web applications in `R`. By the end of this tutorial you should have some basic understanding of how Shiny works, and will make and deploy a Shiny app using data pulled from the [NBA stats API](http://stats.nba.com/). For inspiration and guidance I drew on Thanks to [Todd Schneider's ballR app](https://github.com/toddwschneider/ballr) inspiration and info on how to scrape the data. I highly recommend checking it out!


```{r, echo = FALSE}
knitr::opts_chunk$set(
collapse = TRUE,
fig.width = 6,
fig.asp = .6,
out.width = "90%"
)
```


## Getting started

Before we begin, make sure you have the `shiny`, `plotly`, and  `tidyverse` packages installed. I have created a template for our app, please [download](Downloads/shiny_nba.zip) and unzip this as well.

```{r, eval = FALSE}
install.packages(c("shiny", "plotly", "tidyverse"))
```

Run an example of a simple shiny app to ensure the package is installed properly. 

```{r test_shiny, eval = FALSE}
library(shiny)
runExample("01_hello")
```

A slider bar the allows you to change the number bins in the histogram shown.

## Shiny basics

Each Shiny app has a `ui` and a `server` file, both of which we have to define. The `ui` defines a webpage that the user interacts with, it controls layout and appearance. The `server` file is a set of instructions your computer needs to build the app. `R` code is executed in the background, and output depends on the user input and this `R` code.

<body>
<img src="images/what_is_shiny.png" style="width:75%">
<p><cite>image from</cite> https://deanattali.com/blog/building-shiny-apps-tutorial/</p>
</body>

### The shiny framework

All Shiny apps follow the same overall structure. `fluidPage()` controls the page layout for the ui. We define `server` as a function with arguments `input` and `output`.

```{r shiny_template, eval = FALSE}
library(shiny)
ui <- fluidPage()
server <- function(input, output) {}
shinyApp(ui = ui, server = server)
```

This template itself is a minimal Shiny app, try running the code.  Copy this template into a new file called `app.R`, and save it in a new folder. After saving the file, you should see a _Run App_ button at the top, indicating RStudio has recognized the file as a Shiny app.

<img src="images/empty_app.png" style="width:100%">

Two ways to create Shiny apps:

1. Put both `ui` and `server` code into single file called `app.R`, ideal for simple apps. If you are using a single file, the file **must** be called `app.R` for the app to run.
1. Create separate `ui.R` and `server.R` files, ideal for more complicated apps.

We will use the second approach for this tutorial. This is the preferable way to write apps unless your app is super simple. You can initialize a Shiny app using either approach right from RStudio:

<img src="images/initiate_app1.png" style="width:100%">

Select **Shiny Web App...** and the following will pop up:

<img src="images/initiate_app2.png" style="width:100%">

Select **Multiple File** to generate an app with separate `ui.R` and `server.R` files. I called my app "new_app" and stored it in a folder on my Desktop. To run the app you can do either of the following:

1. Open the `server.R` or `ui.R` file and click the Run App button.
1. Enter `shiny::runApp("~/Desktop/new_app/")` in your R console

This is intended to show how a Shiny app can be initialized. For the rest of the tutorial we will be working with the `shiny_nba` file I provided.

## Shiny NBA

If you haven't already, download and unzip the [shiny_nba](Downloads/shiny_nba.zip) folder provided. Open the .Rproj in the folder - this will open up RStudio and automatically set your working directory to this folder. Notice what's in the folder:

* a `ui.R` file
* a `server.R` file
* a `nba_shots.RData` data object which contains the data for our app
* a `helper.R` file with extra `R` code our app uses

Try running the app. The app has a gray box on the side with dropdown menus that allows you to select a basketball player and season, and space on the right which is where a plot will go. This design is called `sidebarLayout()`. [Many more flexible layouts are possible](https://shiny.rstudio.com/articles/layout-guide.html) as well, but we won't cover them here.

### Input options 

Input is defined through input functions called [widgets](https://shiny.rstudio.com/tutorial/written-tutorial/lesson3/). These are text elements a user can interact with, like scroll bars or buttons. Our app uses `selectInput()` to create a drop-down menu, but many other input functions are available.

<img src="images/widgets.png" style="width:75%">


All input functions have `inputId` and `label` as the first two arguments. The `inputId` is a string that the server side will use to access the value of the user input. For example, if `inputId = "slider_widget"` then on the server side you would use `input$slider_widget` to use its value.`label` is the title for the widget that will show up in the ui.

**Exercise**: Try adding another widget to the sidebar.

### Output options and render statements

Output options go in the `ui.R` file. The first argument of all output functions is "outputId", which is used to identify each output and therefore must be unique for each output. Examples include `plotOutput()`, `textOutput()`, `tableOutput()`.

**Debugging tip**: Make sure you have a comma between each input call and output call! Commas are needed between elements for the `ui` but not for the `server`.

Render statements go in the `server.R` file. They take user input from the widgets and execute a function. Examples including `renderTable()` to make tables, `renderText()` for text, and `renderPlot()` for certain plots (*works with plots made using base* `R` *or* `ggplot2` *but for plots made using* `plotly` *use* `renderPlotly()`). 

Render statements are actually part of a larger and more flexible class of server-side functions called **reactive expressions** but we cover those later.

Run your `shiny_nba` app with the code below added. 

```{r, eval = FALSE}
##### place in mainPanel of ui.R under plotOutput
textOutput("player_text"),

# html tag
hr()

##### place in shinyServer of server.R
output$player_text<- renderText({ 
  paste0("The player you have chosen is ", input$player_choice)
})

```

The `renderPrint()` statement prints out the current selection from the player drop down menu. The `hr()` bit is a wrapper for the html tag `<hr>` and creates a horizontal line. There are a bunch of [awesome html wrapper functions](https://shiny.rstudio.com/articles/tag-glossary.html) to help you customize your user interface.

**Debugging tip**: Make sure you have a comma between each render call. 
**Exercise: add another html tag to your UI**

### Court plot

Let's add a plot. We are going to plot the locations of all the attempted shots made by the selected NBA star. Add the following to your `server.R`. (**update wherever else you need to also, and mention it here! Also mention what help functions were used to create this plot. Maybe create plot in another function?)

```{r eval = FALSE}

```


**Debugging tip**: if the non-Shiny version of your plot isn't working, your Shiny version won't either! Make sure to test complicated code before placing it in the Shiny framework.



flow:

* open new folder with nba app using that R project
* run app to show what it looks like (should be empty frame)
* add one tab, use this to mention that you can make the layout complicated with different ways to lay it out and lots of tabs. Links to resources for this at the bottom,
but I'm not going to focus on it right now.
* talk about widgets
* put data in the right place
* load libraries in the right place
* build widget to access datanames, show what turns up in different scenarios
* build ggplot object that shows cour data for the subject. Place ggplot object into the shiny framework and edit it to show how you incorporate it into shiny. Make sure it runs first!
* add basketball icon to tab of this thing

### Adding a tab


### Plotly

## reactive vs. observer stuff

## Debugging shiny

## Deploying your app

## Resources

* [Embedding Shiny in Rmarkdown documents](https://rmarkdown.rstudio.com/authoring_shiny.html)

* ["Case Studies in Shiny": Dean Attali's short course at DataCamp](https://www.datacamp.com/courses/building-web-applications-in-r-with-shiny-case-studies)

* [Gallery of user-submitted Shiny apps](http://www.showmeshiny.com/)
* [Shiny cheatsheet](http://shiny.rstudio.com/images/shiny-cheatsheet.pdf)
